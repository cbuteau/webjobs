/* uglified webjobs...good luck */
"use strict";define("src/BasicResolver",[],function(){function e(e){this.options=e}return e.prototype={baseUrl:function(){return this.isInJasmine()?location.origin+"/base":location.origin},isInJasmine:function(){return"function"==typeof expect},resolve:function(e){return this.baseUrl()+(0===e.indexOf("/")?e:"/"+e)},getrequirePath:function(){return this.isInJasmine()?window.__karma__.requirePath:this.options.requirePath}},e}),define("src/DispatcherHelper",["src/MessageIds"],function(r){var e=null;function t(){if(null!==e)throw new Error("Cannot instantiate twice");this.initialize()}return t.prototype={initialize:function(){},execute:function(t,e,s){try{var r=s(t,e);this.success(t,r)}catch(e){this.fail(t,e)}},success:function(e,t){postMessage({msg:r.DISPATCH_COMPLETE,workerId:e,payload:t})},fail:function(e,t){if(t instanceof Error){var s=t;t={message:s.message,stack:s.stack}}postMessage({msg:r.DISPATCH_ERROR,workerId:e,error:t})}},t.getInstance=function(){return null===e&&(e=new t),e},t.getInstance()}),define("src/MessageIds",[],function(){var e={SCRIPTLOADED:0,BASEINIT:1,BASEINIT_COMPLETE:2,BASEINIT_ERROR:3,DISPATCH:4,DISPATCH_COMPLETE:5,DISPATCH_ERROR:6};return Object.freeze(e),e}),define("src/ThePool",["src/WorkerStates","src/WorkerProxy"],function(s,r){var e=null;function t(){this.list=[],this.completed=[],this.boundStateUpdate=this.stateUpdate.bind(this)}return t.prototype={dropoff:function(e){var t=this.list.indexOf(e);this.completed.push(e),this.list.splice(t,1)},pickup:function(e){var t;return 0<this.completed.length&&(t=this.completed.pop()),void 0===t?((t=new r(e)).subscribe("StateChanged",this.boundStateUpdate),this.list.push(t)):t.restart(e),t},stateUpdate:function(e,t){console.log("id:"+t.settings.id+" state:"+e),e===s.COMPLETED&&this.dropoff(t)}},e||(e=new t),e}),define("src/TroubleMaker",["src/MessageIds","src/WorkerStates","src/ThePool","src/WorkerProxy"],function(i,a,s,r){var e=null;function t(){this.workers={}}return t.prototype={setup:function(e){this.options=e,this.requirejsBaseUrl=require.toUrl("")},start:function(e){var t=s.pickup({jobparams:e.jobparams,baseUrl:this.requirejsBaseUrl,requirePath:this.options.fullPathToRequire,jobPath:e.jobPath,timeout:e.timeout});return(this.workers[t.settings.workerId]=t).getPromise()},start_proxy:function(e){var t=this._resolve("src/BaseThread.js"),s=new r({jobparams:e.jobparams,baseUrl:this.requirejsBaseUrl,requirePath:this.options.resolver.getrequirePath(),jobPath:e.jobPath,basePath:t,timeout:e.timeout});return(this.workers[s.settings.workerId]=s).getPromise()},_workerOnMessage:function(e){var t=e.data;switch(t.msg){case i.SCRIPTLOADED:var s=this._flattenWorkers();s.sort(function(e,t){return e.startTime-t.startTime}),(o=s[0]).state=a.LOADED;for(var r=o.messages.pop();r;)o.postMessage(r),r=o.messages.pop();break;case i.BASEINIT_COMPLETE:t.workerId?((o=this.workers[t.workerId]).state=a.INITIALIZED,o.postMessage({msg:i.DISPATCH,workerId:t.workerId,params:o.jobparams})):console.error("No workerId in message");break;case i.BASEINIT_ERROR:t.workerId?((o=this.workers[t.workerId]).state=a.COMPLETED,o.reject(t.error)):console.error("No workerId in message");break;case i.DISPATCH_COMPLETE:this.workers[t.workerId].resolve(t.payload);break;case i.DISPATCH_ERROR:var o;console.error(t.error),t.workerId&&(o=this.workers[t.workerId]).reject(t.error);break;default:console.error('Response did not have valid msg code "'+t.msg)}},_resolve:function(e){return this.options.resolver.resolve(e)},_flattenWorkers:function(){var e=[];for(var t in this.workers){var s=this.workers[t];e.push(s)}return e},_cleanupWorkers:function(){}},e||(e=new t),e}),define("src/WorkerProxy",["src/WorkerStates","src/MessageIds"],function(r,o){var t=[];function i(){return""+Math.random().toString(36).substr(2,9)}function e(e){this.messages=[],this.callbacks=[],this.settings={},this.jobparams=e.jobparams,this.settings.state=r.STARTING,this.settings.id=function(){for(var e=i();-1!==t.indexOf(e);)e=i();return t.push(e),e}();var s=this;this._promise=new Promise(function(e,t){s.reject=t,s.resolve=e});try{this._worker=new Worker("BaseThread.js"),this._worker.onmessage=this.onMessage.bind(this),this.settings.startTime=Date.now(),this.settings.state=r.STARTED,this.queue({msg:o.BASEINIT,baseUrl:e.baseUrl,jobPath:e.jobPath,workerId:this.settings.id,requirePath:e.requirePath}),e.timeout&&setTimeout(function(){s.rejectReason="timeout",s.reject(new Error("Job Timeout"))},e.timeout)}catch(e){this.settings.state=r.COMPLETED,this.reject(e)}}return e.prototype={onMessage:function(e){var t=e.data;switch(t.msg){case o.SCRIPTLOADED:this.process(),this.updateState(r.STARTED);break;case o.BASEINIT_COMPLETE:this.settings.state=r.INITIALIZED,this._worker.postMessage({msg:o.DISPATCH,workerId:t.workerId,params:this.jobparams}),this.updateState(r.JOB);break;case o.BASEINIT_ERROR:this.updateState(r.COMPLETED),this.reject(t.error);break;case o.DISPATCH_COMPLETE:this.resolve(t.payload),this.updateState(r.COMPLETED);break;case o.DISPATCH_ERROR:this.reject(t.error),this.updateState(r.COMPLETED);break;default:console.log("Unhandled = "+t.msg)}},queue:function(e){this.messages.push(e)},process:function(){for(var e=this.messages.pop();e;)this._worker.postMessage(e),e=this.messages.pop()},restart:function(e){var s=this;this._promise=new Promise(function(e,t){s.reject=t,s.resolve=e}),this.jobparams=e.jobparams,this.queue({msg:o.BASEINIT,baseUrl:e.baseUrl,jobPath:e.jobPath,workerId:this.settings.id,requirePath:e.requirePath}),e.timeout&&setTimeout(function(){s.rejectReason="timeout",s.reject(new Error("Job Timeout"))},e.timeout),this.process()},subscribe:function(e,t){this.callbacks.push(t)},updateState:function(e){this.settings.state=e;for(var t=0;t<this.callbacks.length;t++)this.callbacks[t](e,this)},getPromise:function(){return this._promise}},e}),define("src/WorkerStates",[],function(){var e={STARTING:0,STARTED:1,LOADED:2,INITIALIZED:3,DISPATCH:4,COMPLETED:5};return Object.freeze(e),e});